# 90 Years with Harvard Business Review

I'm working on the Harvard Business Review data set (a [kaggle](http://www.kaggle.com/) [thing](https://www.kaggle.com/c/harvard-business-review-vision-statement-prospect/)). I want to make the timeline more physically intuitive and more closely linked to the pages of HBR. I'm using R with knitr (R markdown) and showing all my work, with some use of stopifnot() and commenting some things out.

```{r main}
# read in the provided file, available on the kaggle site
# https://www.kaggle.com/c/harvard-business-review-vision-statement-prospect/data
hbr <- read.csv('HBR Citations_correct_abstracts.csv',
              strip.white=TRUE,
              as.is=TRUE)

# make sure we've got the expected number of observations
# as checked against the Excel files that were originally provided
stopifnot(nrow(hbr)==12751)

# confirm that there's always at most one of
# ABSTRACT or AUTHOR.SUPPLIED.ABSTRACT
stopifnot(all(hbr$ABSTRACT=="" | hbr$AUTHOR.SUPPLIED.ABSTRACT==""))
# and put it in a more convenient place
hbr$abstract <- ifelse(hbr$ABSTRACT!="",hbr$ABSTRACT,hbr$AUTHOR.SUPPLIED.ABSTRACT)
# preserve information just in case
hbr$abstract_type <- ifelse(hbr$ABSTRACT!="","HBR",
                            ifelse(hbr$AUTHOR.SUPPLIED.ABSTRACT!="","author",
                                   "none"))

# fix up the dates
# without this you incorrectly get results like year 2068, etc...
hbr$dm <- substr(hbr$SYSTEM..PUB.DATE,1,6)
hbr$y <- substr(hbr$SYSTEM..PUB.DATE,7,8)
hbr$dmY <- ifelse(as.numeric(hbr$y)>20,
                  paste(hbr$dm,"19",hbr$y,sep=""),
                  paste(hbr$dm,"20",hbr$y,sep=""))
hbr$date <- as.Date(hbr$dmY,format="%d-%b-%Y")

# note: look at "PUBLICATION.DATE"          "VOLUME"                    "ISSUE"

# there are too many columns that I don't care about separately
# there has GOT to be a better way to do this:
hbr$naics <- ""
for (j in grep("DESC",names(hbr))) {
  hbr$naics <- paste(hbr$naics, hbr[[j]])
}
hbr$subjects <- ""
for (j in grep("TERM",names(hbr))) {
  hbr$subjects <- paste(hbr$subjects, hbr[[j]])
}
hbr$keywords <- ""
for (j in grep("KEYWORD",names(hbr))) {
  hbr$keywords <- paste(hbr$keywords, hbr[[j]])
}
hbr$affils <- ""
for (j in grep("AFFIL",names(hbr))) {
  hbr$affils <- paste(hbr$affils, hbr[[j]])
}
# not sure how/if I want to completely deal with names yet
# this just does most frequent authors
# and adds a count of authors per article thing
first_names <- c()
last_names <- c()
names <- c()
affils <- c()
hbr$n_authors <- 0
for (i in 1:20) {
  last <- paste("AUTHOR.",i,".LAST.NAME",sep="")
  last_names <- c(last_names, hbr[[last]])
  first <- paste("AUTHOR.",i,".FIRST.NAME",sep="")
  first_names <- c(first_names, hbr[[first]])
  affil <- paste("AUTHOR.",i,".AFFILIATION",sep="")
  affils <- c(affils, hbr[[affil]]) 
  # if there's anything, that's an author
  hbr$n_authors <- hbr$n_authors + ifelse(hbr[[last]]=="" &
                                          hbr[[first]]=="" &
                                          hbr[[affil]]=="",
                                          0,1)
}
names <- paste(first_names,last_names)
# meet the most prolific HBR authors
#tail(sort(table(names)),20)

# authors per article over time
with(hbr, smoothScatter(date,n_authors))

# look at more stuff about number authors
with(hbr, tapply(n_authors,DOCUMENT.TYPE,mean,na.rm=T))

# look at total words
# total entries
nrow(hbr)
# with word count
nrow(hbr[!is.na(hbr$FULL.TEXT.WORD.COUNT),])
# most of these also have page counts
nrow(hbr[!is.na(hbr$PAGE.COUNT) & !is.na(hbr$FULL.TEXT.WORD.COUNT),])
# but nearly everything has page count
nrow(hbr[!is.na(hbr$PAGE.COUNT),])
# so use the average of entries with both to get
# an estimated total words for all entries
with(hbr[!is.na(hbr$PAGE.COUNT) & !is.na(hbr$FULL.TEXT.WORD.COUNT),], 
     sum(FULL.TEXT.WORD.COUNT)/sum(PAGE.COUNT)) * 
       with(hbr[!is.na(hbr$PAGE.COUNT),], sum(PAGE.COUNT))

# load graphics
library(ggplot2)
theme_set(theme_bw())

# could be useful
Sys.setenv(NOAWT=TRUE)
library(tm)
data("crude")
crude[[1]]
stemDocument(crude[[1]])
```
