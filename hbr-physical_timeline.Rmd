# 90 Years with Harvard Business Review

I'm working on the Harvard Business Review data set (a [kaggle](http://www.kaggle.com/) [thing](https://www.kaggle.com/c/harvard-business-review-vision-statement-prospect/)). I want to make the timeline more physically intuitive and more closely linked to the pages of HBR. I'm using R with knitr (R markdown) and showing all my work, with some use of stopifnot() and commenting some things out.

```{r}
# set up graphics for later
library(ggplot2)
theme_set(theme_bw())

# Read in the provided file, available at the kaggle site
# https://www.kaggle.com/c/harvard-business-review-vision-statement-prospect/data
hbr <- read.csv('HBR Citations_correct_abstracts.csv',
              strip.white=TRUE,
              as.is=TRUE)
# This was working fine for a while and then knitr decided it couldn't handle
# some unicode characters or something, so I had to do this on the command line:
# LC_CTYPE=C tr -c -d "[:alnum:][:punct:][:space:]" \
# < HBR\ Citations_correct_abstracts.csv > hbr.csv
# cp HBR\ Citations_correct_abstracts.csv original.csv
# mv hbr.csv HBR\ Citations_correct_abstracts.csv
# Your mileage may vary.

# make sure we've got the expected number of observations
# as checked against the Excel files that were originally provided
stopifnot(nrow(hbr)==12751)

# confirm that there's always at most one of
# ABSTRACT or AUTHOR.SUPPLIED.ABSTRACT
stopifnot(all(hbr$ABSTRACT=="" | hbr$AUTHOR.SUPPLIED.ABSTRACT==""))
# and put it in a more convenient place
hbr$abstract <- ifelse(hbr$ABSTRACT!="",hbr$ABSTRACT,hbr$AUTHOR.SUPPLIED.ABSTRACT)
# preserve information just in case
hbr$abstract_type <- ifelse(hbr$ABSTRACT!="","HBR",
                            ifelse(hbr$AUTHOR.SUPPLIED.ABSTRACT!="","author",
                                   "none"))

# fix up the dates
# without this you incorrectly get results like year 2068, etc...
# the substringing only works because all the dates are 8 character
stopifnot(all(nchar(hbr$SYSTEM..PUB.DATE)==8))
hbr$dm <- substr(hbr$SYSTEM..PUB.DATE,1,6)
hbr$y <- substr(hbr$SYSTEM..PUB.DATE,7,8)
hbr$dmY <- ifelse(as.numeric(hbr$y)>20,
                  paste(hbr$dm,"19",hbr$y,sep=""),
                  paste(hbr$dm,"20",hbr$y,sep=""))
hbr$date <- as.Date(hbr$dmY,format="%d-%b-%Y")
hbr$year <- as.numeric(substr(hbr$date,1,4))
```

The first issue seems to have been published `r min(as.character(hbr$date))`. Everyone seems to agree on the year, at least. The [HBR wikipedia page](http://en.wikipedia.org/wiki/Harvard_Business_Review) adds this interesting tidbit:
> Harvard Business Review began in 1922 as a magazine for Harvard Business School. Founded under the auspices of Dean Wallace Donham, HBR was meant to be more than just a typical school publication. "The paper [HBR] is intended to be the highest type of business journal that we can make it, and for use by the student and the business man. It is not a school paper," Donham wrote.

```{r}

# note: look at "PUBLICATION.DATE"          "VOLUME"                    "ISSUE"
sort(unique(hbr$PUBLICATION.DATE[hbr$year==2010]))
sort(unique(hbr$VOLUME))
sort(unique(hbr$ISSUE))
length(sort(unique(hbr$y)))
sort(unique(hbr$date[hbr$VOLUME==2]))
# interesting...
dpy <- data.frame("year"=1922:2012,"peryear"=sapply(1922:2012,function(x){length(unique(hbr$date[hbr$year==x]))}))
qplot(year, peryear, data=dpy, main="publication dates per year")
```

There's some fluctuation from special supplements and just irregularities, but broadly it was quartlerly, then bi-monthly, then close to monthly.

```{r}

# there are too many columns that I don't care about separately
# there has GOT to be a better way to do this:
hbr$naics <- ""
for (j in grep("DESC",names(hbr))) {
  hbr$naics <- paste(hbr$naics, hbr[[j]])
}
hbr$subjects <- ""
for (j in grep("TERM",names(hbr))) {
  hbr$subjects <- paste(hbr$subjects, hbr[[j]])
}
hbr$keywords <- ""
for (j in grep("KEYWORD",names(hbr))) {
  hbr$keywords <- paste(hbr$keywords, hbr[[j]])
}
hbr$affils <- ""
for (j in grep("AFFIL",names(hbr))) {
  hbr$affils <- paste(hbr$affils, hbr[[j]])
}
# not sure how/if I want to completely deal with names yet
# this just does most frequent authors
# and adds a count of authors per article thing
first_names <- c()
last_names <- c()
names <- c()
affils <- c()
hbr$n_authors <- 0
for (i in 1:20) {
  last <- paste("AUTHOR.",i,".LAST.NAME",sep="")
  last_names <- c(last_names, hbr[[last]])
  first <- paste("AUTHOR.",i,".FIRST.NAME",sep="")
  first_names <- c(first_names, hbr[[first]])
  affil <- paste("AUTHOR.",i,".AFFILIATION",sep="")
  affils <- c(affils, hbr[[affil]]) 
  # if there's anything, that's an author
  hbr$n_authors <- hbr$n_authors + ifelse(hbr[[last]]=="" &
                                          hbr[[first]]=="" &
                                          hbr[[affil]]=="",
                                          0,1)
}
names <- paste(first_names,last_names)
# meet the most prolific HBR authors
#tail(sort(table(names)),20)

# authors per article over time
with(hbr, smoothScatter(date,n_authors))

# look at more stuff about number authors
with(hbr, tapply(n_authors,DOCUMENT.TYPE,mean,na.rm=T))

# look at total words
# total entries
nrow(hbr)
# with word count
nrow(hbr[!is.na(hbr$FULL.TEXT.WORD.COUNT),])
# most of these also have page counts
nrow(hbr[!is.na(hbr$PAGE.COUNT) & !is.na(hbr$FULL.TEXT.WORD.COUNT),])
# but nearly everything has page count
nrow(hbr[!is.na(hbr$PAGE.COUNT),])
# so use the average of entries with both to get
# an estimated total words for all entries
with(hbr[!is.na(hbr$PAGE.COUNT) & !is.na(hbr$FULL.TEXT.WORD.COUNT),], 
     sum(FULL.TEXT.WORD.COUNT)/sum(PAGE.COUNT)) * 
       with(hbr[!is.na(hbr$PAGE.COUNT),], sum(PAGE.COUNT))


# could be useful
Sys.setenv(NOAWT=TRUE)
library(tm)
data("crude")
crude[[1]]
stemDocument(crude[[1]])
# and these are all vectorized
temp <- removeNumbers(crude[[1]])
temp <- removePunctuation(temp)
temp <- tolower(temp)
temp <- gsub('\n',' ',temp)
stemDocument(temp)
```
